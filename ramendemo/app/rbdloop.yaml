---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: ramendemo
  labels:
    appname: rbdloop
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi
  storageClassName: ocs-storagecluster-ceph-rbdmirror
---
apiVersion: v1
kind: Pod
metadata:
  name: batch-4k
  labels:
    appname: rbdloop
spec:
  containers:
    - name: batch-4k
      image: quay.io/vcppds7878/busybox:rbdloop
      imagePullPolicy: IfNotPresent
#      command: ["sh"]
#      args:
#        - '-c'
#        - 'sleep 3600'
      command: ["python3"]
      args:
        - '/tmp/runloop.py'
        - '--size'
        - '--server'
        - '--port'
      env:
      - name: BLOCKSIZE
        value: "4096"
      - name: SQL_SERVER
        value: "ramendemo-mysql-mysql.apps.makestoragegreatagain.com"
      - name: SQL_PORT
        value: "30136"
      - name: SQL_URL
        value: "https://gist.githubusercontent.com/jeanchlopez/0cdd2a30562b735c3bb384bd734282b7/raw/900ac1a34a3c98fc0f668a24d1e7dc8ef107f6dc/sqlserver.url"
      volumeMounts:
        - name: tmp-store
          mountPath: /mnt/test
  volumes:
    - name: tmp-store
      persistentVolumeClaim:
        claimName: ramendemo
        readOnly: false
  restartPolicy: Never
